<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Labelly</title>

  <!-- Favicon -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />

  <!-- OG -->
  <meta property="og:title" content="Labelly" />
  <meta property="og:description" content="é…é€ãƒ»è¿”å“ãƒ»è¡¨è¨˜ãªã©ã€è¦‹è½ã¨ã—ã‚„ã™ã„æ¡ä»¶ã‚’äº‹å‰ã«è¦‹ãˆã‚‹åŒ–ã—ã¾ã™ã€‚" />
  <meta property="og:image" content="/og.svg" />
  <meta property="og:type" content="website" />

  <style>
    :root {
      --bg: #f3f6fb;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e6edf6;
      --shadow: 0 18px 50px rgba(2, 6, 23, .08);
      --shadow2: 0 10px 30px rgba(2, 6, 23, .06);

      --blue: #2f5bff;
      --nav: #0a0f1f;
      --nav2: #070a12;

      --green: #16a34a;
      --yellow: #f59e0b;
      --orange: #f97316;
      --red: #ef4444;

      --radius: 22px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 50% -200px, rgba(47, 91, 255, .18), transparent 60%), var(--bg);
    }

    /* Header */
    header {
      padding: 16px 18px;
      background: linear-gradient(180deg, var(--nav), var(--nav2));
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 14px 50px rgba(0, 0, 0, .25);
    }

    .brand {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
    }

    .brand svg {
      display: block;
    }

    .brand .word {
      font-weight: 800;
      letter-spacing: .4px;
      font-size: 28px;
      color: #fff;
      transform: translateY(2px);
      /* yã®ã¶ã‚“ã ã‘å°‘ã—ä¸‹ã¸ */
      line-height: 1;
    }

    /* Layout */
    .wrap {
      max-width: 980px;
      margin: 28px auto 60px;
      padding: 0 16px;
    }

    .hero {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px 26px 22px;
    }

    .hero h1 {
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 800;
      color: #334155;
      text-align: center;
      letter-spacing: .2px;
    }

    .hero p {
      margin: 0 0 18px;
      color: var(--muted);
      text-align: center;
      line-height: 1.7;
    }

    .inputRow {
      display: grid;
      grid-template-columns: 1fr 110px;
      gap: 14px;
      align-items: center;
      margin-top: 12px;
    }

    input[type="url"] {
      width: 100%;
      font-size: 18px;
      padding: 16px 18px;
      border-radius: 14px;
      border: 2px solid #dbe7ff;
      outline: none;
      background: #eef4ff;
      transition: .15s;
    }

    input[type="url"]:focus {
      border-color: rgba(47, 91, 255, .55);
      box-shadow: 0 0 0 4px rgba(47, 91, 255, .12);
      background: #f7faff;
    }

    button {
      border: 0;
      background: var(--blue);
      color: white;
      border-radius: 14px;
      padding: 15px 16px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(47, 91, 255, .25);
      transition: .15s transform, .15s filter;
    }

    button:hover {
      filter: brightness(1.02);
    }

    button:active {
      transform: translateY(1px);
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .note {
      margin-top: 12px;
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.7;
    }

    /* Result */
    .result {
      margin-top: 20px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .resultHead {
      padding: 20px 22px 16px;
      border-bottom: 1px solid var(--border);
    }

    .titleRow {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
      font-size: 26px;
      letter-spacing: .2px;
      flex-wrap: wrap;
    }

    .dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      display: inline-block;
      box-shadow: 0 0 0 5px rgba(0, 0, 0, .03);
      flex: 0 0 auto;
    }

    .subRow {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 14px;
      align-items: center;
    }

    /* Score ring */
    .scoreCard {
      border: 1px solid var(--border);
      border-radius: 18px;
      background: #fff;
      box-shadow: var(--shadow2);
      padding: 14px 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ring {
      width: 120px;
      height: 120px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ring svg {
      width: 120px;
      height: 120px;
    }

    .ring .center {
      position: absolute;
      text-align: center;
      line-height: 1.1;
    }

    .ring .center .num {
      font-size: 28px;
      font-weight: 950;
      letter-spacing: .2px;
    }

    .ring .center .lab {
      margin-top: 4px;
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
    }

    /* Platform + domain chips */
    .chips {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .chip {
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: #334155;
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 13px;
      font-weight: 800;
    }

    .badge {
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 13px;
      font-weight: 950;
      border: 1px solid rgba(15, 23, 42, .08);
      background: #fff;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      box-shadow: 0 10px 24px rgba(2, 6, 23, .06);
    }

    .badge .pill {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      display: inline-block;
      background: #94a3b8;
    }

    .badge.amazon .pill {
      background: #111827;
    }

    .badge.rakuten .pill {
      background: #dc2626;
    }

    .badge.base .pill {
      background: #111827;
    }

    .badge.shopify .pill {
      background: #22c55e;
    }

    .badge.stores .pill {
      background: #2563eb;
    }

    .badge.unknown .pill {
      background: #94a3b8;
    }

    .oneLine {
      margin-top: 16px;
      padding: 14px 14px;
      border-radius: 14px;
      background: #f1f5f9;
      color: #0f172a;
      font-weight: 800;
      line-height: 1.6;
      display: none;
      gap: 10px;
      align-items: flex-start;
    }

    .oneLine .bulb {
      font-size: 18px;
      line-height: 1.2;
    }

    .grid3 {
      padding: 18px 22px 6px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }

    .mini {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px 16px;
      background: #fff;
      box-shadow: var(--shadow2);
      min-height: 90px;
    }

    .mini .k {
      color: var(--muted);
      font-weight: 800;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .mini .v {
      font-size: 18px;
      font-weight: 900;
      line-height: 1.45;
    }

    .split {
      border-top: 1px solid var(--border);
      padding: 18px 22px 24px;
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
    }

    .box {
      border: 1px solid var(--border);
      border-radius: 18px;
      background: #fff;
      padding: 16px 16px;
      box-shadow: var(--shadow2);
      min-height: 160px;
    }

    .box h3 {
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
    }

    ul {
      margin: 0;
      padding-left: 20px;
      color: #0f172a;
      line-height: 1.8;
    }

    li {
      margin: 6px 0;
    }

    .muted {
      color: var(--muted);
    }

    .footerNote {
      padding: 0 22px 22px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.8;
    }

    /* Evidence toggle */
    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      color: var(--blue);
      font-weight: 950;
      margin-top: 14px;
    }

    .toggle .tri {
      display: inline-block;
      transform: rotate(0deg);
      transition: .15s;
    }

    .toggle.open .tri {
      transform: rotate(90deg);
    }

    .evidenceWrap {
      padding: 0 22px 22px;
    }

    .evidence {
      margin-top: 12px;
      border: 1px solid var(--border);
      border-radius: 18px;
      background: #fff;
      box-shadow: var(--shadow2);
      padding: 14px 14px;
      display: none;
    }

    .evidence.open {
      display: block;
    }

    .evGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .evBox {
      border: 1px solid #e9eef7;
      border-radius: 14px;
      padding: 12px 12px;
      background: #fbfdff;
    }

    .evBox h4 {
      margin: 0 0 10px;
      font-size: 14px;
      font-weight: 950;
      color: #334155;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .count {
      font-size: 11px;
      color: #334155;
      background: #eef2ff;
      border: 1px solid #dbeafe;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 950;
      flex: 0 0 auto;
    }

    .evList {
      margin: 0;
      padding-left: 18px;
      color: #0f172a;
      line-height: 1.7;
      font-size: 13px;
    }

    .evMono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: #0f172a;
      background: #f3f6fb;
      border: 1px solid #e5edf8;
      border-radius: 12px;
      padding: 10px 10px;
      overflow: auto;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .urlList a {
      font-weight: 800;
    }

    .tools {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .toolBtn {
      border: 1px solid #dbe7ff;
      background: #eef4ff;
      color: #1d4ed8;
      font-weight: 950;
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      box-shadow: none;
      font-size: 13px;
    }

    .toolBtn:hover {
      filter: none;
      background: #e7efff;
    }

    .toolBtn:active {
      transform: translateY(1px);
    }

    a {
      color: var(--blue);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Optional block (serverãŒè¿”ã•ãªã„æ™‚ã¯ç©º) */
    #explanation:empty {
      display: none !important;
    }

    @media (max-width: 820px) {
      .grid3 {
        grid-template-columns: 1fr;
      }

      .split {
        grid-template-columns: 1fr;
      }

      .inputRow {
        grid-template-columns: 1fr;
      }

      button {
        width: 100%;
      }

      .titleRow {
        font-size: 22px;
      }

      .subRow {
        grid-template-columns: 1fr;
      }

      .scoreCard {
        justify-content: flex-start;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="brand" aria-label="Labelly">
      <!-- Tag icon -->
      <svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M7 12a6 6 0 0 1 6-6h18l8 10-8 10H13a6 6 0 0 1-6-6V12z" fill="#2f5bff" />
        <circle cx="15.5" cy="18.5" r="3.1" fill="#fff" />
      </svg>
      <div class="word">Labelly</div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>ã“ã®é€šè²©ã‚µã‚¤ãƒˆã§ã€Œã‚ã¨ã‹ã‚‰å›°ã‚‰ãªã„ã‹ï¼Ÿã€</h1>
      <p>é…é€ãƒ»è¿”å“ãƒ»è¡¨è¨˜ãªã©ã€è¦‹è½ã¨ã—ã‚„ã™ã„æ¡ä»¶ã‚’äº‹å‰ã«è¦‹ãˆã‚‹åŒ–ã—ã¾ã™ã€‚</p>

      <div class="inputRow">
        <input id="urlInput" type="url" placeholder="https://example.com" value="https://www.beerbeerbeer.beer/" />
        <button id="goBtn">è¨ºæ–­</button>
      </div>

      <div class="note">â€»ã“ã®è¨ºæ–­ã¯å…¬é–‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã—ãŸæ¨å®šã§ã™ã€‚å®Ÿéš›ã®æ¡ä»¶ã¯è²©å£²è€…ã®æ¡ˆå†…ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</div>
    </section>

    <!-- optional explanation block -->
    <div class="explain" id="explanation"></div>

    <section id="result" class="result" style="display:none;">
      <div class="resultHead">
        <div class="titleRow">
          <span id="dot" class="dot"></span>
          <span id="labelText">â€”</span>
        </div>

        <div class="subRow">
          <!-- score -->
          <div class="scoreCard">
            <div class="ring" aria-label="ä¿¡é ¼ã‚¹ã‚³ã‚¢">
              <svg viewBox="0 0 120 120" role="img" aria-hidden="true">
                <circle cx="60" cy="60" r="48" stroke="#e8eef8" stroke-width="12" fill="none"></circle>
                <circle id="ringArc" cx="60" cy="60" r="48" stroke="#2f5bff" stroke-width="12" fill="none" stroke-linecap="round" transform="rotate(-90 60 60)" stroke-dasharray="302" stroke-dashoffset="302"></circle>
              </svg>
              <div class="center">
                <div class="num" id="scoreNum">-</div>
                <div class="lab">ä¿¡é ¼ã‚¹ã‚³ã‚¢</div>
              </div>
            </div>
          </div>

          <!-- chips -->
          <div class="chips">
            <span class="chip" id="chipDomain">ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼š-</span>
            <span class="badge unknown" id="platformBadge"><span class="pill"></span><span id="chipPlatform">æ¨å®šï¼š-</span></span>
          </div>
        </div>

        <div id="oneLine" class="oneLine">
          <span class="bulb">ğŸ’¡</span>
          <div id="oneLineText"></div>
        </div>
      </div>

      <div class="grid3">
        <div class="mini">
          <div class="k">é…é€</div>
          <div class="v" id="delivery">-</div>
        </div>
        <div class="mini">
          <div class="k">åˆ°ç€ç›®å®‰</div>
          <div class="v" id="eta">-</div>
        </div>
        <div class="mini">
          <div class="k">è¿”å“</div>
          <div class="v" id="ret">-</div>
        </div>
      </div>

      <div class="split">
        <div class="box">
          <h3>ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</h3>
          <ul id="notesList"></ul>
        </div>

        <div class="box">
          <h3>å‘ã„ã¦ã„ã‚‹äºº</h3>
          <ul id="goodList"></ul>

          <div style="height:12px;"></div>

          <h3>æ³¨æ„ã—ãŸã„äºº</h3>
          <ul id="cautionList"></ul>

          <div class="toggle" id="toggleEvidence">
            <span class="tri">â–¶</span> åˆ¤å®šã®æ ¹æ‹ ã‚’è¦‹ã‚‹
          </div>
        </div>
      </div>

      <div class="evidenceWrap">
        <div id="evidence" class="evidence">
          <div class="evGrid">
            <div class="evBox">
              <h4>UI / åŸºæœ¬æƒ…å ± <span class="count" id="cntUi">0</span></h4>
              <ul class="evList" id="evUi"></ul>
            </div>
            <div class="evBox">
              <h4>é…é€ã®æ ¹æ‹  <span class="count" id="cntShip">0</span></h4>
              <ul class="evList" id="evShip"></ul>
            </div>
            <div class="evBox">
              <h4>è¿”å“ãƒ»è¡¨è¨˜ã®æ ¹æ‹  <span class="count" id="cntRet">0</span></h4>
              <ul class="evList" id="evRet"></ul>
            </div>
            <div class="evBox">
              <h4>ç¢ºèªã—ãŸURL <span class="count" id="cntUrls">0</span></h4>
              <div class="evMono urlList" id="evUrls"></div>
              <div class="tools">
                <button class="toolBtn" id="copyUrlsBtn" type="button">URLã‚’ã‚³ãƒ”ãƒ¼</button>
              </div>
            </div>
          </div>

          <div style="height:12px;"></div>

          <div class="evBox">
            <h4>æŠ½å‡ºã—ãŸæŠœç²‹ï¼ˆçŸ­ã„æŠœç²‹ã®ã¿ï¼‰</h4>
            <div class="evMono" id="evSnips"></div>
          </div>
        </div>
      </div>

      <div class="footerNote">
        â€»æœ¬è¨ºæ–­ã¯å…¬é–‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã—ãŸæ¨å®šã§ã™ã€‚ç‰¹å®šã®äº‹æ¥­è€…ã‚’è©•ä¾¡ãƒ»æ‰¹åˆ¤ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å®Ÿéš›ã®ç´æœŸãƒ»è¿”å“æ¡ä»¶ã¯è²©å£²è€…ã®æ¡ˆå†…ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
      </div>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    const urlInput = $("urlInput");
    const goBtn = $("goBtn");
    const result = $("result");

    const dot = $("dot");
    const labelText = $("labelText");
    const chipDomain = $("chipDomain");
    const chipPlatform = $("chipPlatform");
    const platformBadge = $("platformBadge");

    const scoreNum = $("scoreNum");
    const ringArc = $("ringArc");

    const oneLine = $("oneLine");
    const oneLineText = $("oneLineText");

    const delivery = $("delivery");
    const eta = $("eta");
    const ret = $("ret");

    const notesList = $("notesList");
    const goodList = $("goodList");
    const cautionList = $("cautionList");

    const toggleEvidence = $("toggleEvidence");
    const evidence = $("evidence");

    const evUi = $("evUi");
    const evShip = $("evShip");
    const evRet = $("evRet");
    const evUrls = $("evUrls");
    const evSnips = $("evSnips");

    const cntUi = $("cntUi");
    const cntShip = $("cntShip");
    const cntRet = $("cntRet");
    const cntUrls = $("cntUrls");
    const copyUrlsBtn = $("copyUrlsBtn");

    const RING_LEN = 302; // â‰’ 2Ï€r (r=48)

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function setDotColor(color) {
      const map = {
        green: "var(--green)",
        yellow: "var(--yellow)",
        orange: "var(--orange)",
        red: "var(--red)",
      };
      dot.style.background = map[color] || "var(--muted)";
    }

    function scoreColor(score) {
      const n = Number(score);
      if (!Number.isFinite(n)) return "var(--blue)";
      if (n >= 70) return "var(--green)";
      if (n >= 40) return "var(--yellow)";
      return "var(--orange)";
    }

    function setScoreRing(score) {
      const n = Math.max(0, Math.min(100, Number(score)));
      const offset = RING_LEN - (RING_LEN * (Number.isFinite(n) ? n : 0) / 100);
      ringArc.style.strokeDasharray = String(RING_LEN);
      ringArc.style.strokeDashoffset = String(offset);
      ringArc.style.stroke = scoreColor(n);
      scoreNum.textContent = Number.isFinite(n) ? String(n) : "-";
    }

    function clearList(el) { el.innerHTML = ""; }
    function addItems(el, items) {
      clearList(el);
      (items || []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        el.appendChild(li);
      });
      if (!items || items.length === 0) {
        const li = document.createElement("li");
        li.className = "muted";
        li.textContent = "ï¼ˆæƒ…å ±ãªã—ï¼‰";
        el.appendChild(li);
      }
    }

    function addEvidenceList(el, items) {
      clearList(el);
      (items || []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        el.appendChild(li);
      });
      if (!items || items.length === 0) {
        const li = document.createElement("li");
        li.className = "muted";
        li.textContent = "ï¼ˆè©²å½“ãªã—ï¼‰";
        el.appendChild(li);
      }
    }

    function platformJa(p) {
      const m = {
        amazon: "Amazon",
        rakuten: "æ¥½å¤©",
        base: "BASE",
        shopify: "Shopify",
        stores: "STORES",
        unknown: "ä¸æ˜",
      };
      return m[p] || p || "ä¸æ˜";
    }

    function platformClass(p) {
      const allow = new Set(["amazon", "rakuten", "base", "shopify", "stores", "unknown"]);
      return allow.has(p) ? p : "unknown";
    }

    function renderSnippets(snips) {
      const ui = (snips && snips.ui) ? snips.ui : [];
      const ship = (snips && snips.ship) ? snips.ship : [];
      const retS = (snips && snips.ret) ? snips.ret : [];
      const contact = (snips && snips.contact) ? snips.contact : [];

      const lines = [];
      if (ui.length) lines.push("UI:\n- " + ui.join("\n- "));
      if (ship.length) lines.push("é…é€:\n- " + ship.join("\n- "));
      if (retS.length) lines.push("è¿”å“:\n- " + retS.join("\n- "));
      if (contact.length) lines.push("é€£çµ¡å…ˆã£ã½ã„è¡¨è¨˜:\n- " + contact.join("\n- "));
      if (!lines.length) lines.push("ï¼ˆæŠœç²‹ãªã—ï¼‰");

      evSnips.innerHTML = escapeHtml(lines.join("\n\n"));
    }

    function renderUrls(urls) {
      if (!urls || !urls.length) {
        evUrls.textContent = "ï¼ˆãªã—ï¼‰";
        cntUrls.textContent = "0";
        return;
      }
      cntUrls.textContent = String(urls.length);
      evUrls.innerHTML = urls.map(u => `- <a href="${u}" target="_blank" rel="noopener noreferrer">${escapeHtml(u)}</a>`).join("\n");
    }

    function setCounts(ev) {
      const ui = (ev && ev.ui) ? ev.ui.length : 0;
      const ship = (ev && ev.ship) ? ev.ship.length : 0;
      const retA = (ev && ev.ret) ? ev.ret.length : 0;
      cntUi.textContent = String(ui);
      cntShip.textContent = String(ship);
      cntRet.textContent = String(retA);
    }

    function render(data) {
      result.style.display = "block";

      setDotColor(data.color);
      labelText.textContent = data.labelText || "â€”";

      // domain
      const domain = (() => {
        try { return new URL(data.url).hostname; } catch { return "-"; }
      })();
      chipDomain.textContent = `ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼š${domain}`;

      // platform badge
      const p = data.platform || "unknown";
      chipPlatform.textContent = `æ¨å®šï¼š${platformJa(p)}`;
      platformBadge.className = `badge ${platformClass(p)}`;

      // score ring
      setScoreRing(data.score ?? 0);

      // one-line summary
      if (data.oneLine) {
        oneLine.style.display = "flex";
        oneLineText.textContent = data.oneLine;
      } else {
        oneLine.style.display = "none";
        oneLineText.textContent = "";
      }

      delivery.textContent = data.delivery || "-";
      eta.textContent = data.eta || "-";
      ret.textContent = data.return || "-";

      addItems(notesList, data.notes);
      addItems(goodList, data.good);
      addItems(cautionList, data.caution);

      // evidence
      const ev = data.evidence || {};
      setCounts(ev);
      addEvidenceList(evUi, ev.ui);
      addEvidenceList(evShip, ev.ship);
      addEvidenceList(evRet, ev.ret);
      renderUrls(ev.urlsChecked || []);
      renderSnippets((ev.snippets || {}));
    }

    async function diagnose() {
      const raw = (urlInput.value || "").trim();
      if (!raw) { alert("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

      goBtn.disabled = true;
      goBtn.textContent = "è¨ºæ–­ä¸­â€¦";

      try {
        const res = await fetch("/api/diagnose", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url: raw }),
        });

        if (!res.ok) throw new Error("API error");
        const data = await res.json();
        render(data);

        // evidenceé–‰ã˜ã‚‹
        evidence.classList.remove("open");
        toggleEvidence.classList.remove("open");
      } catch (e) {
        alert("è¨ºæ–­ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      } finally {
        goBtn.disabled = false;
        goBtn.textContent = "è¨ºæ–­";
      }
    }

    goBtn.addEventListener("click", diagnose);
    urlInput.addEventListener("keydown", (e) => { if (e.key === "Enter") diagnose(); });

    toggleEvidence.addEventListener("click", () => {
      const open = evidence.classList.toggle("open");
      toggleEvidence.classList.toggle("open", open);
    });

    copyUrlsBtn.addEventListener("click", async () => {
      const raw = evUrls.innerText || "";
      try {
        await navigator.clipboard.writeText(raw.replace(/\n/g, "\n"));
        copyUrlsBtn.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ";
        setTimeout(() => (copyUrlsBtn.textContent = "URLã‚’ã‚³ãƒ”ãƒ¼"), 1200);
      } catch {
        alert("ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨©é™ã‚’ã”ç¢ºèªãã ã•ã„ï¼‰");
      }
    });
  </script>
</body>
</html>