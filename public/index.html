<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Labelly</title>

  <!-- Favicon / OG -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <meta property="og:title" content="Labelly" />
  <meta property="og:description" content="é…é€ãƒ»è¿”å“ãƒ»è¡¨è¨˜ãªã©ã€è¦‹è½ã¨ã—ã‚„ã™ã„æ¡ä»¶ã‚’äº‹å‰ã«è¦‹ãˆã‚‹åŒ–ã—ã¾ã™ã€‚" />
  <meta property="og:image" content="/og.svg" />
  <meta property="og:type" content="website" />

  <style>
    :root {
      --bg: #eef2f7;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --line: #e5e7eb;
      --shadow: 0 10px 30px rgba(2, 8, 23, .08);
      --shadow2: 0 6px 18px rgba(2, 8, 23, .08);
      --blue: #2563eb;
      --green: #16a34a;
      --yellow: #f59e0b;
      --orange: #f97316;
      --red: #ef4444;
      --radius: 22px;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
      color: var(--text);
      background: var(--bg);
    }

    a {
      color: var(--blue);
      text-decoration: none
    }

    a:hover {
      text-decoration: underline
    }

    header {
      background: radial-gradient(1200px 500px at 50% 0%, rgba(37, 99, 235, .45), rgba(2, 6, 23, 0)), #030712;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      padding: 14px 18px;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .brand {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .brand svg {
      display: block
    }

    .wrap {
      max-width: 980px;
      margin: 26px auto 60px;
      padding: 0 18px;
    }

    .hero {
      background: var(--panel);
      box-shadow: var(--shadow);
      border: 1px solid rgba(2, 6, 23, .06);
      border-radius: var(--radius);
      padding: 28px;
    }

    .hero h1 {
      margin: 0 0 6px;
      font-size: 18px;
      font-weight: 800;
      color: #334155;
      text-align: center;
      letter-spacing: .02em;
    }

    .hero p {
      margin: 0 0 20px;
      text-align: center;
      color: var(--muted);
      line-height: 1.7;
    }

    .bar {
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    .input {
      flex: 1 1 540px;
      max-width: 720px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    input[type="url"] {
      width: 100%;
      padding: 16px 18px;
      border-radius: 16px;
      border: 1px solid #cbd5e1;
      background: #eaf1ff;
      font-size: 18px;
      outline: none;
      transition: box-shadow .15s, border-color .15s;
    }

    input[type="url"]:focus {
      border-color: rgba(37, 99, 235, .65);
      box-shadow: 0 0 0 6px rgba(37, 99, 235, .18);
      background: #eef4ff;
    }

    button {
      padding: 16px 22px;
      border-radius: 16px;
      border: 0;
      background: var(--blue);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(37, 99, 235, .25);
      min-width: 110px;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .note {
      margin-top: 10px;
      text-align: center;
      color: var(--muted);
      font-size: 13px;
    }

    .result {
      margin-top: 22px;
      background: var(--panel);
      box-shadow: var(--shadow2);
      border: 1px solid rgba(2, 6, 23, .06);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .resultHead {
      padding: 22px 22px 16px;
      border-bottom: 1px solid var(--line);
    }

    .summaryLine {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 14px 14px;
      margin-bottom: 16px;
      color: #0f172a;
      font-weight: 700;
      line-height: 1.6;
    }

    .labelRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }

    .labelTitle {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: .01em;
    }

    .pillRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      color: #334155;
      font-weight: 700;
      font-size: 13px;
      white-space: nowrap;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      display: inline-block;
    }

    .dot.green {
      background: var(--green)
    }

    .dot.yellow {
      background: var(--yellow)
    }

    .dot.orange {
      background: var(--orange)
    }

    .dot.red {
      background: var(--red)
    }

    .grid3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      padding: 18px 22px 22px;
      border-bottom: 1px solid var(--line);
    }

    .card {
      border: 1px solid #e2e8f0;
      border-radius: 18px;
      background: #fff;
      padding: 18px;
      min-height: 100px;
    }

    .card h3 {
      margin: 0 0 8px;
      font-size: 14px;
      color: #475569;
      letter-spacing: .02em;
    }

    .card .big {
      font-size: 18px;
      font-weight: 700;
      line-height: 1.5;
      color: #0f172a;
      margin: 0;
    }

    .card .small {
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      padding: 18px 22px 22px;
    }

    .sectionTitle {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 12px;
    }

    ul {
      margin: 0;
      padding-left: 18px;
      color: #0f172a;
      line-height: 1.8;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.7;
    }

    .footerNote {
      padding: 0 22px 22px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.7;
    }

    /* Explanation block (empty hidden) */
    #explanation:empty {
      display: none !important;
    }

    #explanation {
      margin-top: 12px;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px dashed #cbd5e1;
      background: #f8fafc;
      color: #334155;
      font-size: 13px;
      line-height: 1.7;
    }

    details {
      margin-top: 14px;
    }

    summary {
      cursor: pointer;
      user-select: none;
      font-weight: 700;
      color: #1d4ed8;
      list-style: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 12px;
    }

    summary:hover {
      background: #eff6ff
    }

    summary::-webkit-details-marker {
      display: none
    }

    .evidenceBox {
      margin-top: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      background: #ffffff;
      padding: 14px 14px;
    }

    .evGrid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }

    .evCol {
      border: 1px solid #eef2f7;
      border-radius: 14px;
      padding: 12px;
      background: #fbfdff;
    }

    .evCol h4 {
      margin: 0 0 6px;
      font-size: 13px;
      color: #475569;
      letter-spacing: .02em;
    }

    .evCol ul {
      padding-left: 18px;
      margin: 0;
      color: #0f172a;
      font-size: 13px;
      line-height: 1.75;
    }

    .codeLine {
      display: block;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: #0f172a;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      padding: 8px 10px;
      border-radius: 12px;
      margin-top: 8px;
      overflow: auto;
      white-space: nowrap;
    }

    .pageList a {
      display: block;
      margin-top: 6px;
      font-size: 13px;
    }

    .hide {
      display: none !important
    }

    @media (max-width: 900px) {
      .grid3 {
        grid-template-columns: 1fr
      }

      .grid2 {
        grid-template-columns: 1fr
      }

      .labelTitle {
        font-size: 22px
      }

      input[type="url"] {
        font-size: 16px
      }

      .evGrid {
        grid-template-columns: 1fr
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="brand" aria-label="Labelly">
      <!-- Tag icon + white "Labelly" (baseline adjusted slightly downward) -->
      <svg width="240" height="44" viewBox="0 0 240 44" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Labelly logo">
        <path d="M6 8h30l10 14-10 14H6a6 6 0 0 1-6-6V14a6 6 0 0 1 6-6z" fill="#2563EB" />
        <circle cx="14" cy="22" r="3" fill="#fff" />
        <!-- y ã®ãƒ‡ã‚£ã‚»ãƒ³ãƒ€ã§ä¸­å¿ƒãŒã‚ºãƒ¬ã¦è¦‹ãˆã‚‹ã®ã§ baseline ã‚’å°‘ã—ä¸‹ã’ã‚‹ -->
        <text x="60" y="30" font-size="22" font-weight="800" fill="#fff" font-family="Inter, system-ui, sans-serif">
          Labelly
        </text>
      </svg>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>ã“ã®é€šè²©ã‚µã‚¤ãƒˆã§ã€Œã‚ã¨ã‹ã‚‰å›°ã‚‰ãªã„ã‹ï¼Ÿã€</h1>
      <p>é…é€ãƒ»è¿”å“ãƒ»è¡¨è¨˜ãªã©ã€è¦‹è½ã¨ã—ã‚„ã™ã„æ¡ä»¶ã‚’äº‹å‰ã«è¦‹ãˆã‚‹åŒ–ã—ã¾ã™ã€‚</p>

      <div class="bar">
        <div class="input">
          <input id="urlInput" type="url" inputmode="url" placeholder="https://example.com" autocomplete="off" spellcheck="false" />
          <button id="goBtn">è¨ºæ–­</button>
        </div>
      </div>

      <div class="note">â€»ã“ã®è¨ºæ–­ã¯å…¬é–‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã—ãŸæ¨å®šã§ã™ã€‚å®Ÿéš›ã®æ¡ä»¶ã¯è²©å£²è€…ã®æ¡ˆå†…ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</div>

      <div id="resultBox" class="result hide" aria-live="polite">
        <div class="resultHead">
          <div id="summaryLine" class="summaryLine">
            <span>ğŸ’¡</span>
            <span id="summaryText">çµè«–ï¼š</span>
          </div>

          <div class="labelRow">
            <div class="labelTitle">
              <span id="labelDot" class="dot"></span>
              <span id="labelText">â€”</span>
            </div>

            <div class="pillRow">
              <div class="pill" title="æ¨å®šã‚¹ã‚³ã‚¢">
                <span>ä¿¡é ¼ã‚¹ã‚³ã‚¢</span>
                <span id="scoreText">- / 100</span>
              </div>
              <div class="pill" title="ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¨å®šï¼ˆAmazon / æ¥½å¤© / BASE / Shopify / STORES ãªã©ï¼‰">
                <span>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </span>
                <span id="platformText">-</span>
              </div>
              <div class="pill" title="å¯¾è±¡ãƒ‰ãƒ¡ã‚¤ãƒ³">
                <span>ãƒ‰ãƒ¡ã‚¤ãƒ³</span>
                <span id="domainText">-</span>
              </div>
            </div>
          </div>

          <div id="explanation"></div>

          <details>
            <summary>â–¶ åˆ¤å®šã®æ ¹æ‹ ã‚’è¦‹ã‚‹</summary>
            <div class="evidenceBox">
              <div class="evGrid">
                <div class="evCol">
                  <h4>UI / è¡¨è¨˜</h4>
                  <ul id="evUi"></ul>
                  <span id="snipUi" class="codeLine hide"></span>
                </div>
                <div class="evCol">
                  <h4>é…é€</h4>
                  <ul id="evShip"></ul>
                  <span id="snipShip" class="codeLine hide"></span>
                </div>
                <div class="evCol">
                  <h4>è¿”å“ / äº‹æ¥­è€…æƒ…å ±</h4>
                  <ul id="evRet"></ul>
                  <span id="snipRet" class="codeLine hide"></span>
                </div>
              </div>

              <div id="pagesBox" class="pageList" style="margin-top:12px;"></div>
              <div class="muted" style="margin-top:10px;">
                â€»ã‚¹ã‚³ã‚¢ãƒ»åˆ¤å®šã¯ã€Œå…¬é–‹ãƒšãƒ¼ã‚¸ã‹ã‚‰å–å¾—ã§ããŸæƒ…å ±ã€ã«ä¾å­˜ã—ã¾ã™ã€‚ãƒ–ãƒ­ãƒƒã‚¯/åœ°åŸŸåˆ¶é™/JSæç”»ã®å½±éŸ¿ã§å–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
              </div>
            </div>
          </details>
        </div>

        <div class="grid3">
          <div class="card">
            <h3>é…é€</h3>
            <p id="deliveryText" class="big">â€”</p>
            <div id="deliveryNote" class="small"></div>
          </div>
          <div class="card">
            <h3>åˆ°ç€ç›®å®‰</h3>
            <p id="etaText" class="big">â€”</p>
            <div id="etaNote" class="small"></div>
          </div>
          <div class="card">
            <h3>è¿”å“</h3>
            <p id="returnText" class="big">â€”</p>
            <div id="returnNote" class="small"></div>
          </div>
        </div>

        <div class="grid2">
          <div class="card">
            <div class="sectionTitle">ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</div>
            <ul id="notesList"></ul>
          </div>

          <div class="card">
            <div class="sectionTitle">å‘ã„ã¦ã„ã‚‹äºº</div>
            <ul id="goodList"></ul>

            <div style="height:14px;"></div>

            <div class="sectionTitle">æ³¨æ„ã—ãŸã„äºº</div>
            <ul id="cautionList"></ul>
          </div>
        </div>

        <div class="footerNote">
          â€»æœ¬è¨ºæ–­ã¯å…¬é–‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã—ãŸæ¨å®šã§ã™ã€‚ç‰¹å®šã®äº‹æ¥­è€…ã‚’è©•ä¾¡ãƒ»æ‰¹åˆ¤ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å®Ÿéš›ã®ç´æœŸãƒ»è¿”å“æ¡ä»¶ã¯è²©å£²è€…ã®æ¡ˆå†…ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
        </div>
      </div>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    const urlInput = $("urlInput");
    const goBtn = $("goBtn");
    const resultBox = $("resultBox");

    function setDot(color) {
      const dot = $("labelDot");
      dot.className = "dot";
      if (color === "green") dot.classList.add("green");
      else if (color === "yellow") dot.classList.add("yellow");
      else if (color === "orange") dot.classList.add("orange");
      else if (color === "red") dot.classList.add("red");
      else dot.classList.add("orange");
    }

    function clearList(ul) {
      ul.innerHTML = "";
    }
    function fillList(ul, items) {
      clearList(ul);
      (items || []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });
    }

    function setMaybeText(el, text) {
      el.textContent = (text == null || text === "") ? "â€”" : text;
    }

    function showSnip(el, snippets) {
      const list = (snippets || []).filter(Boolean);
      if (!list.length) {
        el.classList.add("hide");
        el.textContent = "";
        return;
      }
      el.classList.remove("hide");
      el.textContent = list.join(" / ");
    }

    function normalizePlatform(p) {
      if (!p) return "-";
      return String(p);
    }

    function buildExplanation(result) {
      // ã“ã“ã¯ã€Œäººã«åˆºã•ã‚‹ä¸€è¨€ï¼‹é€æ˜æ€§ã€ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®çŸ­æ–‡ã€‚
      // server.js ã‹ã‚‰ explanation ã‚’è¿”ã™ãªã‚‰ãã‚Œã‚’å„ªå…ˆã€‚
      if (result.explanation) return result.explanation;

      const score = (typeof result.score === "number") ? result.score : null;
      const platform = result.platform || result.platformGuess;
      const gotPages = Array.isArray(result.evidence?.pages) && result.evidence.pages.length;

      const bits = [];
      if (platform) bits.push(`ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¨å®šï¼š${normalizePlatform(platform)}`);
      if (score != null) bits.push(`ä¿¡é ¼ã‚¹ã‚³ã‚¢ï¼š${score}/100`);
      if (gotPages) bits.push(`å‚ç…§ãƒšãƒ¼ã‚¸ï¼š${result.evidence.pages.length}ä»¶`);
      return bits.length ? bits.join(" / ") : "";
    }

    function renderPages(pages) {
      const box = $("pagesBox");
      box.innerHTML = "";
      if (!Array.isArray(pages) || pages.length === 0) return;

      const title = document.createElement("div");
      title.className = "muted";
      title.style.marginBottom = "6px";
      title.textContent = "å‚ç…§ã—ãŸãƒšãƒ¼ã‚¸ï¼ˆæ¨å®šï¼‰ï¼š";
      box.appendChild(title);

      pages.forEach(p => {
        const a = document.createElement("a");
        a.href = p.url;
        a.target = "_blank";
        a.rel = "noreferrer";
        a.textContent = `ãƒ»${p.label || "ãƒšãƒ¼ã‚¸"}ï¼š${p.url}`;
        box.appendChild(a);
      });
    }

    function renderResult(result) {
      resultBox.classList.remove("hide");

      // åŸºæœ¬
      setDot(result.color);
      setMaybeText($("labelText"), result.labelText);
      setMaybeText($("deliveryText"), result.delivery);
      setMaybeText($("etaText"), result.eta);
      setMaybeText($("returnText"), result.return);

      // 1è¡Œçµè«–ï¼ˆserver.js ã‹ã‚‰ summary ã‚’è¿”ã™ãªã‚‰å„ªå…ˆï¼‰
      const summary = result.summary || `çµè«–ï¼š${result.color === "green" ? "å›½å†…å‘ã‘ã®è³¼å…¥ã¯ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã‚„ã™ã„ã€‚" :
        result.color === "yellow" ? "ç´æœŸã‚„è¿”å“æ¡ä»¶ã®äº‹å‰ç¢ºèªã§â€œäº‹æ•…â€ã‚’é˜²ã’ã‚‹ã€‚" :
          result.color === "orange" ? "è³¼å…¥å‰ã«æ¡ä»¶æ•´ç†ãŒå¿…è¦ã€‚" : "è³¼å…¥å‰ã«è‡ªå·±ç¢ºèªãŒå¿…é ˆã€‚"}`;
      $("summaryText").textContent = summary;

      // ãƒ”ãƒ«ï¼ˆã‚¹ã‚³ã‚¢/ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ /ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
      const score = (typeof result.score === "number") ? result.score : null;
      $("scoreText").textContent = (score == null) ? "- / 100" : `${score} / 100`;

      const platform = result.platform || result.platformGuess || "-";
      $("platformText").textContent = normalizePlatform(platform);

      try {
        const u = new URL(result.url || urlInput.value.trim());
        $("domainText").textContent = u.hostname || "-";
      } catch {
        $("domainText").textContent = "-";
      }

      // èª¬æ˜æ ï¼ˆç©ºãªã‚‰éè¡¨ç¤ºï¼‰
      const exp = buildExplanation(result);
      $("explanation").textContent = exp;

      // ç®‡æ¡æ›¸ã
      fillList($("notesList"), result.notes || ["æœ€çµ‚çš„ãªé…é€æ—¥æ•°ãƒ»è¿”å“æ¡ä»¶ã¯è³¼å…¥å‰ã«å…¬å¼è¡¨è¨˜ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚"]);
      fillList($("goodList"), result.good || ["æ—¥å¸¸åˆ©ç”¨", "æ€¥ãã®è²·ã„ç‰©"]);
      fillList($("cautionList"), result.caution || ["é™å®šå•†å“ã®åœ¨åº«åˆ‡ã‚Œ", "ã‚»ãƒ¼ãƒ«æ™‚ã®åœ¨åº«å¤‰å‹•"]);

      // æ ¹æ‹ 
      fillList($("evUi"), result.evidence?.ui || []);
      fillList($("evShip"), result.evidence?.ship || []);
      fillList($("evRet"), result.evidence?.ret || []);

      showSnip($("snipUi"), result.evidence?.snippets?.ui);
      showSnip($("snipShip"), result.evidence?.snippets?.ship);
      showSnip($("snipRet"), result.evidence?.snippets?.ret);

      renderPages(result.evidence?.pages || []);

      // ãƒ¡ãƒ¢æ¬„ï¼ˆä½¿ã£ã¦ãªã„ãªã‚‰ç©ºï¼‰
      $("deliveryNote").textContent = "";
      $("etaNote").textContent = "";
      $("returnNote").textContent = "";
    }

    async function diagnose() {
      const url = urlInput.value.trim();
      if (!url) {
        alert("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      goBtn.disabled = true;
      goBtn.textContent = "è¨ºæ–­ä¸­â€¦";

      try {
        const res = await fetch("/api/diagnose", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });

        if (!res.ok) {
          throw new Error("bad_response");
        }

        const data = await res.json();
        renderResult(data);

      } catch (e) {
        alert("è¨ºæ–­ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        console.error(e);
      } finally {
        goBtn.disabled = false;
        goBtn.textContent = "è¨ºæ–­";
      }
    }

    goBtn.addEventListener("click", diagnose);
    urlInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") diagnose();
    });
  </script>
</body>
</html>